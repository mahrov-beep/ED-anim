# Описание поведения ботов на базе Behaviour Tree из Quantum bot SDK.

## Важные референсы

- Официальный пример реализации ботов в игре на подобии Brawl Stars на базе Photon Quantum 3 Bot SDK лежат тут: /src/Samples/quantum-twinstickshooter-3.0.7/Assets/QuantumUser/Simulation/AI/
- Примеры моей первой рабочей, но не очень удачной реализации: /src/Samples/Legacy-BehaviourTree/
- Официальная документация:
    - Behaviour Tree https://doc.photonengine.com/quantum/current/addons/bot-sdk/bt
    - Shared Concepts (btw BT/HFSM/UT) https://doc.photonengine.com/quantum/current/addons/bot-sdk/shared-concepts

## Важные замечания:

- Архитектура
    - BT (раз в N фреймов) — высокоуровневые решения:
        - Состояние: Idle / Patrol / Alert / Combat
        - Навигация: куда идти (waypoint или позиция врага)
        - Действия: стрелять, перезаряжаться
    - ECS (каждый кадр) — исполнение:
        - Камера: смотрит на врага (из Perception) или по направлению движения
        - Джойстик: применяет DesiredDirection к Input
        - Плавные переходы, интерполяция
    - BT не трогает камеру/движение напрямую. Всё через ECS.

---

## Ветка Idle ("В зоне тревоги никого нет, В зоне атаки никого нет" → **Idle**)

- Проигрывает idle-анимацию
- С вероятностью 50% переходит в патруль, иначе повторяет idle
- С вероятностью 25% перед переходом в патруль говорит случайную фразу из отдельного списка
- Проверяет состояние зон тревоги и атаки раз в N секунд
- Если получен урон или в зоне атаки появился противник — переходит в Бой
- Если в зоне тревоги появился противник — переходит в состояние Тревога

---

## Ветка Патруль

- Движется к следующему ключ. пункту
- Если бот агрессивный, бежит, иначе идёт (анимация бега)
- Если бот спокойный — приоритетнее анимация движения шагом
- Проверяет состояние зон тревоги и атаки раз в N секунд
- Если противник в зоне тревоги — включается тревога
- Если противник в зоне атаки — включается Бой
- Если противник ушёл — переходит в idle, пока дойдёт до следующего вейпоинта

---

## Ветка Тревога ("В зоне тревоги появился враг" → **Idle**)

- С вероятностью 75% говорит случайную фразу из тревожного списка
- Начинает разворот в сторону противника 
- Переходит в преследование, ждёт N-ую секунду
- Проверяет состояние зон тревоги и атаки раз в N секунд
- Если противник оказался в зоне атаки — переходит в Бой
- Если противника нет в зоне тревоги — переходит в Патруль
- Если противник в зоне тревоги, но не в зоне атаки — выбирает точку рядом с противником на расстоянии N2 и идёт туда.
  N — радиус зоны тревоги.

---

## Ветка Бой — Агрессивный бот ("В зоне атаки появился противник" → **Бой**)

- С вероятностью 75% говорит фразу из "формульного списка", с указанием "тип противника" для бота
- Наводится на противника
- Ждёт N-ую секунду
- Делает N-ое выстрелов, а остаток от тика надгорит группу. Попадает каждым выстрелом с настраиваемой вероятностью
- Стреляет куском хп по выстрелам
- Берёт оружие за противником
- Релоад, атака, закончив завершает стрельбу
- Если убил противника — говорит фразу
- При стрельбе, если в магазине <10% патронов, перезаряжается
- Если не убил противника — начинает стрелять
- Находит точку рядом с противником из которого целится и начинает снова стрелять
- Бежит на новую точку. С вероятностью добить сдаётся после того, как добили.
- Если не убил, но цель ушла из зоны атаки — преследует на N секунд
- Если догнал — начинает заново
- Если не делает никого в зоне атаки — переходит в Тревогу или idle

---

## Ветка Бой — Спокойный бот ("В зоне атаки появился противник" → **Бой**)

- Наводится на противника
- Ждёт n-ую секунду
- Делает N-ое выстрелов, в зависимости от типа надгорит
- Попадает каждым выстрелом с настраиваемой вероятностью стрельбы за время стрельбы
- Берёт оружие за противником
- Релоад, атака, закончив завершает стрельбу
- Если убил противника — говорит фразу
- При стрельбе, если в магазине <10% патронов, перезаряжается
- Если не убил противника и сменяет цель
- Находит точку у противника на расстоянии N2 (>радиус стрельбы зоны противника)
- Бежит на первую точку и садится. Разворачивается в сторону, где был противник.
- Если противник есть в зоне атаки — начинает заново
- Если противника нет — возвращается в тревогу или idle

---

# Модульное описание

> У агрессивного и спокойного бота могут быть разные числовые значения параметров и некоторые детали модулей

## Модуль жизни

- Проверяет хп бота и состояния, отвечает за тик работы модулей.
- При смерти, горении, попадании в газовое облако: включает определенные реплики/звуки

## Модуль зрения

- Следит за пространством вокруг себя: перед собой полусфера размера N, со спины полусфера N/2.

## Модуль слуха

- Слушает на настраиваемое расстояние крики ботов, стрельбу
- Отвечает за зону тревоги (????видимо зона тревоги это радиус на котором слышно врага?????)
- Переключает бота в тревогу, если слышит звук

## Модуль стрельбы

- Отвечает за стрельбу
- Зависит от оружия

## Модуль перемещения

- Отвечает за перемещение, стрейфы
